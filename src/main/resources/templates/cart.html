<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Gi·ªè H√†ng - Shop C√¢y C·∫£nh</title>
    <link rel="stylesheet" href="/css/style.css" />
</head>
<body>

<header>
    <div class="header-flex">
        <span class="shop-title">Little</span>
        <img src="/images/leaf.png" alt="leaf logo" class="logo-img" />
        <form class="search-form" onsubmit="handleSearch(event)">
            <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm" />
            <button type="submit" aria-label="T√¨m ki·∫øm">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <circle cx="9" cy="9" r="7" stroke="#fff" stroke-width="2" />
                    <line x1="14.2" y1="14.2" x2="18" y2="18" stroke="#fff" stroke-width="2" stroke-linecap="round" />
                </svg>
            </button>
        </form>
    </div>
</header>

<nav class="nav">
    <a href="/">Trang Ch·ªß</a>
    <a href="/invoice">H√≥a ƒê∆°n</a>
    <a href="/cart" class="active">Gi·ªè H√†ng</a>
    <a href="/contact">Li√™n H·ªá</a>
    <div class="nav-user" th:if="${user != null}">
        <span class="user-id" th:text="${user.UserName}">T√™n ng∆∞·ªùi d√πng</span>
        <form class="formlogout" action="/logout" method="post">
            <button type="submit" class="logout-btn">ƒêƒÉng xu·∫•t</button>
        </form>
    </div>
</nav>

<main class="container">
    <h2 class="section-title">üõí Gi·ªè H√†ng C·ªßa B·∫°n</h2>
    <div id="cartItems" class="products"></div>

    <div style="margin-top: 30px; text-align: center;">
        <h3 id="totalPrice" style="color: #2e7d32;">T·ªïng ti·ªÅn: 0 VNƒê</h3>
        <button onclick="checkout()" class="logout-btn">Thanh To√°n</button>
    </div>
</main>

<footer>
    ¬© 2025 Shop C√¢y C·∫£nh. ƒê√£ ƒëƒÉng k√Ω b·∫£n quy·ªÅn.
</footer>

<script>
    let cart = [];

    async function loadCart() {
        try {
            const response = await fetch('/api/auth/cartData');
            if (!response.ok) {
                const errorText = await response.text();
                document.getElementById("cartItems").innerHTML = `<p>L·ªói: ${errorText}</p>`;
                return;
            }

            cart = await response.json();
            console.log("üì¶ D·ªØ li·ªáu gi·ªè h√†ng:", cart); // DEBUG
            renderCart();
        } catch (error) {
            console.error("L·ªói khi t·∫£i gi·ªè h√†ng:", error);
            document.getElementById("cartItems").innerHTML = "<p>Kh√¥ng th·ªÉ t·∫£i gi·ªè h√†ng.</p>";
        }
    }

    function renderCart() {
        const cartItemsDiv = document.getElementById("cartItems");
        cartItemsDiv.innerHTML = "";

        let total = 0;

        if (cart.length === 0) {
            cartItemsDiv.innerHTML = "<p>Gi·ªè h√†ng tr·ªëng.</p>";
            document.getElementById("totalPrice").innerText = "T·ªïng ti·ªÅn: 0 VNƒê";
            return;
        }

        cart.forEach(item => {
            const product = item.product;
            const itemTotal = product.ProductPrice * item.quantity;

            const itemDiv = document.createElement("div");
            itemDiv.className = "product-card";
            itemDiv.innerHTML = `
                <img src="${product.ProductImage}" alt="${product.ProductName}" class="product-img" />
                <div class="product-info">
                    <h3>${product.ProductName}</h3>
                    <p>Gi√°: ${product.ProductPrice.toLocaleString()} VNƒê</p>
                    <p>S·ªë l∆∞·ª£ng: ${item.quantity}</p>
                    <p>Th√†nh ti·ªÅn: ${itemTotal.toLocaleString()} VNƒê</p>
                </div>
            `;

            total += itemTotal; // ‚úÖ ƒê√∫ng r·ªìi
            cartItemsDiv.appendChild(itemDiv);
        });

        document.getElementById("totalPrice").innerText = "T·ªïng ti·ªÅn: " + total.toLocaleString() + " VNƒê";
    }

    function checkout() {
        alert("T√≠nh nƒÉng thanh to√°n ch∆∞a ƒë∆∞·ª£c tri·ªÉn khai.");
    }

    window.addEventListener("DOMContentLoaded", loadCart);
</script>



</body>
</html>
